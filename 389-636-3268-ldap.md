# 389,636,3268 - LDAP

Find LDAP base naming context:

```shell
ldapsearch -H ldap://$IP -x -s base namingcontexts
```

* -H = host
* -x = simple authentication (anonymous)
* -s = search scope





Dump LDAP directory data from a specific base:

{% code overflow="wrap" %}
```shell
ldapsearch -H ldap://$IP -x -b"DC=hutch,DC=offsec" > ldap_dump.txt
```
{% endcode %}

* -b "DC=hutch,DC=offsec": Sets the search base DN to `DC=hutch,DC=offsec`&#x20;

Extract info from ldap\_dump.txt:

{% code overflow="wrap" %}
```sh
grep -E "^(cn|sAMAccountName|mail|memberOf|userPrincipalName):" ldap_dump.txt
```
{% endcode %}

Copy all usernames into a file:

{% code overflow="wrap" %}
```sh
grep -h '^sAMAccountName:' ldap_dump.txt | sed 's/^sAMAccountName: *//' > usernames.txt

grep -h '^sAMAccountName:' ldap_dump.txt | sed 's/^sAMAccountName: *//' | grep -v ' ' | sort -u > usernames.txt
```
{% endcode %}

```sh
grep -i password ldap_dump.txt
```

Extract full block that contains a specifc value:

```sh
awk -v RS="" '/CrabSharkJellyfish192/' ldap_dump.txt
```

Print username relating to any found password (username:password):

{% code overflow="wrap" %}
```sh
PASSWORD="CrabSharkJellyfish192"

awk -v RS="" -v passwd="$PASSWORD" '
  $0 ~ passwd {
    n = split($0, lines, /\n/)
    user = ""
    for (i=1; i<=n; i++) {
      if (lines[i] ~ /^sAMAccountName: /) {
        # Extract username after "sAMAccountName: "
        sub(/^sAMAccountName: /, "", lines[i])
        user = lines[i]
        break
      }
    }
    if (user != "") print user ":" passwd
  }
' ldap_dump.txt

```
{% endcode %}

\
